<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
		<!-- Google Chrome Frame也可以让IE用上Chrome的引擎: -->
		<meta name="renderer" content="webkit">
		<!--国产浏览器高速模式-->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Mr.Jiang" />
		<title>职位发布变更</title>
		
		<!-- 导航元素依赖 开始 -->	
		<link rel="stylesheet" href="../../css/font.css">
		<link rel="stylesheet" href="../../css/xadmin.css">
		<script src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/xadmin.js"></script>
		<!-- 导航元素依赖 结束 -->
	</head>
	<body>
		<!-- 头部导航 开始 -->
		<div class="x-nav">
		  <span class="layui-breadcrumb">
		    <a href="">你正在做的业务是</a>
		    <a href="">人力资源</a>
			<a href="">招聘管理</a>
			<a href="">职位发布管理</a>
		    <a>
		      <cite>职位发布变更</cite></a>
		  </span>
		  <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
		    <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
		</div>
		<!-- 头部导航 结束 -->
		
		<!-- 表单元素开始 -->
		<form class="layui-form" id="frm">
			<table class="layui-table" lay-skin="row">
				<tbody>
					<tr>
						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">I级机构</label>
								<div class="layui-input-block">

									<input type="hidden" name="mreId" id="mreId">

									<select name="firstKindId" id="firstKindId" lay-filter="firstKind">
										<option value="-1"></option>
									</select>
								</div>
							</div>
						</td>

						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">Ⅱ级机构</label>
								<div class="layui-input-block">
									<select name="secondKindId" id="secondKindId" lay-filter="secondKind">
										<option value="-1"></option>
									</select>
								</div>
							</div>
						</td>

						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">Ⅲ级机构</label>
								<div class="layui-input-block">
									<select id="thirdKindId" name="thirdKindId" lay-filter="thirdKind">
										<option value="-1"></option>
									</select>
								</div>
							</div>
						</td>
						
						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">招聘类型</label>
								<div class="layui-input-block">
									<select id="engageType" name="engageType" lay-verify="required">
										<option value=""></option>
										<option value="社会招聘">社会招聘</option>
										<option value="校园招聘">校园招聘</option>
									</select>
								</div>
							</div>
						</td> 
					</tr>
					
					<tr>
						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">职位分类</label>
								<div class="layui-input-block">
									<select id="majorKindId" name="majorKindId" lay-verify="required">
										<option value=""></option>
									</select>
								</div>
							</div>
						</td>
						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">职位名称</label>
								<div class="layui-input-block">
									<select id="majorId" name="majorId" lay-verify="required">
										<option value=""></option>
									</select>
								</div>
							</div>
						</td>
						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">招聘人数</label>
								<div class="layui-input-block">
									<input type="number" name="humanAmount" id="humanAmount" required  lay-verify="required" placeholder="请输入人数" autocomplete="off" class="layui-input">
								</div>
							</div>
						</td>

						<!-- 变更人后台获取~ -->
						<td>
							<div class="layui-form-item">
								<label class="layui-form-label">截止日期</label>
								<div class="layui-input-block">
									<div class="layui-inline"> <!-- 注意：这一层元素并不是必须的 -->
										<input type="text" name="deadline" placeholder="请选中日期" class="layui-input" id="test1">
									</div>
								</div>
							</div>
						</td>
					</tr>

					
					<tr>
						<td colspan="4">
							<div class="layui-form-item layui-form-text">
							  <label class="layui-form-label">职位描述</label>
							  <div class="layui-input-block">
							    <textarea name="majorDescribe" id="majorDescribe" placeholder="请输入内容" class="layui-textarea"></textarea>
							  </div>
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="4">
							<div class="layui-form-item layui-form-text">
							  <label class="layui-form-label">招聘要求</label>
							  <div class="layui-input-block">
							    <textarea name="engageRequired" id="engageRequired" placeholder="请输入内容" class="layui-textarea"></textarea>
							  </div>
							</div>
						</td>
					</tr>
					
					<tr align="center">
						<td colspan="4">
							<div class="layui-form-item">
							  <div class="layui-input-block">
							    <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
							    <button type="reset" class="layui-btn layui-btn-primary">清除</button>
							  </div>
							</div>
						</td>
					</tr>
					
				</tbody>
			</table>
		</form>
		<!-- 表单元素结束 -->

		<!-- 加载下拉框数据.. -->
		<script src="../../js/data/recruitment/common.js" type="text/javascript"></script>

		<!-- 验证 -->
		<script src="../../js/data/common/verifyToken.js" type="text/javascript"></script>
		
		<script>
			/* 
				下拉框依赖
			 */
			layui.use(['form', 'layer', 'jquery'], function(){
			  let form = layui.form;
			  let layer = layui.layer;
			  let $ = layui.jquery;
			  
			  //监听提交
			  form.on('submit(formDemo)', function(data){
				// layer.msg(JSON.stringify(data.field));

				  let firstKindName = $("#firstKindId option:selected").text().trim();
				  let secondKindName = $("#secondKindId option:selected").text().trim();
				  let thirdKindName = $("#thirdKindId option:selected").text().trim();
				  let majorKindName = $("#majorKindId option:selected").text().trim();
				  let majorName = $("#majorId option:selected").text().trim();

				  let post_data = "firstKindName=" + firstKindName + "&secondKindName=" + secondKindName
						  + "&thirdKindName=" + thirdKindName + "&majorKindName=" + majorKindName + "&majorName=" + majorName + "&";

				  post_data = post_data + $("#frm").serialize();

				  // console.log(post_data)

				  $.ajax({
					url: "http://127.0.0.1:8080/ssm/engage-major-release/upd",
				  	beforeSend: function (xhr) {
					  xhr.setRequestHeader("jwtToken", localStorage.getItem("jwtToken"));
					},
					type: "post",
					data: post_data,
					success: res => {
						console.log(res)
						if (res.code === 200) {
							layer.msg(res.message)
						} else {
							layer.msg(res.message)
						}
					},
					error: e => {
						console.log(e)
					}
				})

				return false;
			  });
			});	

			// 日期相关
			layui.use('laydate', function(){
			  let laydate = layui.laydate;
			  
			  //执行一个laydate实例
			  laydate.render({
				elem: '#test1',type:'datetime'//指定元素
			  });
			  //执行一个laydate实例
			  laydate.render({
					elem: '#test2',type:'datetime' //指定元素
			  });
			});

			// my operation
			layui.use([ 'jquery', 'layer', 'form', 'table'], function() {
				let $ = layui.jquery;
				let form = layui.form;


				// do sth
				let id = getQueryVariable("id");

				$.ajax({
					url: "http://127.0.0.1:8080/ssm/engage-major-release/one/" + id,
					type: "get",
					success: res => {
						if (res.code === 200) {
							console.log(res.data)

							let l1 = res.data.firstKindId;
							let l2 = res.data.secondKindId;
							let l3 = res.data.thirdKindId;

							if (l1>0) {
								$("#firstKindId").find("option[value='" + l1 +"']").attr("selected",true);
							}
							if (l2>0) {
								$("#secondKindId").find("option[value='" + l2 +"']").attr("selected",true);
							}
							if (l3>0) {
								$("#thirdKindId").find("option[value='" + l3 +"']").attr("selected",true);
							}

							$("#engageType").find("option[value='" + res.data.engageType +"']").attr("selected",true);
							$("#majorKindId").find("option[value='" + res.data.majorKindId +"']").attr("selected",true);
							$("#majorId").find("option[value='" + res.data.majorId +"']").attr("selected",true);

							$("#humanAmount").val(res.data.humanAmount)
							$("#test1").val(res.data.deadline)
							$("#engageRequired").val(res.data.engageRequired)
							$("#majorDescribe").val(res.data.majorDescribe)

							// some name...
							$("#mreId").val(res.data.mreId)

							form.render('select') // 刷新
							// engageRequired majorDescribe
							// 让下拉框选中..
							/**
							 * 1、设置value为pxx的项选中

							 $(".selector").val("pxx");

							 2、设置text为pxx的项选中

							 $(".selector").find("option[text='pxx']").attr("selected",true);

							 3、获取当前选中项的value

							 $(".selector").val();

							 4、获取当前选中项的text

							 $(".selector").find("option:selected").text();
							 */

						}
					}
				})



			})

			// 用于获取url的参数值
			function getQueryVariable(variable)
			{
				let query = window.location.search.substring(1);
				let vars = query.split("&");
				for (let i=0;i<vars.length;i++) {
					let pair = vars[i].split("=");
					if(pair[0] == variable){return pair[1];}
				}
				return(false);
			}
		</script>	
		
	</body>
</html>
